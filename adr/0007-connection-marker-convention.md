# ADR-0007: 接続マーカー規約

## ステータス

採用

## コンテキスト

漢文テキストにおいて、声調変化（tone sandhi）は連続して発音される文字間でのみ発生する。しかし、原文テキストからは文字間の接続・区切りを自動判定できない。

例：「不亦說乎」
- 「不亦」は連続して読む → 声調変化が発生（4声+4声 → 2声+4声）
- 「説」と「乎」の間は区切り → 声調変化なし

## 決定

テキストデータ内で **ハイフン（`-`）を接続マーカー** として使用する。

### ルール

1. **デフォルトは区切り**: 文字間にマーカーがなければ、それぞれ独立した発音単位とみなす
2. **`-` は接続を示す**: `A-B` は「A と B を連続して読む」ことを意味する
3. **表示時は非表示**: `-` は画面表示時に除去される
4. **声調変化の適用範囲**: 接続された文字グループ内でのみ声調変化ルールを適用する

### 記法例

```text
# 入力テキスト
子曰 學而時習之 不-亦說乎 有朋自遠方來 不-亦樂乎

# 解釈
- "子曰"      → 区切り（それぞれ独立）
- "學而時習之" → 区切り（それぞれ独立）
- "不-亦"     → 接続（声調変化適用: bù yì → bú yì）
- "說乎"      → 区切り
```

### 声調変化ルール（接続グループ内で適用）

| パターン | 変化 | 例 |
|----------|------|-----|
| 3声 + 3声 | 2声 + 3声 | 你-好 → ní hǎo |
| 4声 + 4声 | 2声 + 4声 | 不-是 → bú shì |

## 根拠

- **明示的**: 接続箇所を明示するため、曖昧さがない
- **シンプル**: 1 文字のマーカーで表現可能
- **可読性**: 原文の構造が保たれ、人間が読んでも理解しやすい
- **編集容易**: Git 管理のテキストファイルで直接編集可能
- **処理単純**: パーサー実装がシンプル

## 影響

- コンテンツ作成者は接続箇所に `-` を明示的に記述する必要がある
- `HakubunWithTabs` コンポーネントが `-` マーカーを解釈し、声調変化を動的に計算する
- 編集 UI は不要（Git でテキストファイルを直接編集）

## 関連

- [ADR-0006: コンテンツ保存戦略](./0006-content-storage-strategy.md)
- `src/components/HakubunWithTabs.tsx` - マーカー処理の実装
