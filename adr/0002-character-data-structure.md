# ADR-0002: 人物データ構造と ID 命名規則

## ステータス

承認済み

## コンテキスト

四書五経学習サイトでは、人物（孔子、弟子、その他登場人物）を管理する必要がある。

### 要件

1. **人物情報の管理**: 名前、字（あざな）、諱（いみな）などを管理
2. **一意な ID**: コンテンツの `speaker` フィールドで参照するための一意な識別子
3. **URL フレンドリー**: 人物ページの URL として使用可能
4. **可読性**: データを見たときにある程度推測可能

### 検討したアプローチ

#### アプローチ A: 漢字を ID として使用

```typescript
{ id: "孔子", name: "孔子" }
```

**却下理由**:
- URL が `/characters/%E5%AD%94%E5%AD%90` のようにエンコードされ、可読性が低い
- 異体字による不一致リスク

#### アプローチ B: 英語名を ID として使用

```typescript
{ id: "confucius", name: "孔子" }
```

**却下理由**:
- 英語名が存在しない人物が多い（弟子など）
- 一貫性がない

## 決定

ピンインベースの ID を採用し、衝突時は諱（名）で区別する。

### スキーマ

```typescript
interface Character {
  id: string;               // ピンインベースのID（例: "kongzi"）
  name: string;             // 表示名（例: "孔子"）
  courtesy_name?: string;   // 字（例: "仲尼"）
  personal_name?: string;   // 諱（例: "丘"）
  aliases: string[];        // 別名・別称（例: ["夫子", "孔丘"]）
  pinyin?: string;          // 発音（例: "Kǒng Zǐ"）
  description?: string;     // 簡単な説明
}
```

### ID 命名規則

#### 基本規則

1. **通称のピンイン**を使用（声調記号なし、小文字）
   - 孔子 → `kongzi`
   - 孟子 → `mengzi`
   - 子路 → `zilu`
   - 子貢 → `zigong`

2. **字（あざな）で呼ばれる人物**は字のピンインを使用
   - 子路（仲由の字）→ `zilu`
   - 子貢（端木賜の字）→ `zigong`

#### 衝突時の規則

ピンインが衝突する場合、**諱（名）のピンイン**をハイフンで追加する。

**例: 晏子 vs 顔子**

| 人物 | 姓 | 諱 | 字 | 通称ピンイン | 衝突 |
|------|----|----|----|----|------|
| 晏嬰 | 晏（Yàn） | 嬰（Yīng） | 平仲 | yanzi | ✓ |
| 顔回 | 顔（Yán） | 回（Huí） | 子淵 | yanzi | ✓ |

**解決**:
- 晏子 → `yanzi-ying`
- 顔子 → `yanzi-hui`

**なぜ姓ではなく諱を使うか**:
- 姓のピンインも衝突する可能性がある（晏 Yàn / 顔 Yán → 声調なしでは両方 `yan`）
- 諱は全員が持っている（字がない人物もいる）

### 具体例

```typescript
// 孔子
{
  id: "kongzi",
  name: "孔子",
  courtesy_name: "仲尼",
  personal_name: "丘",
  aliases: ["夫子", "孔丘", "仲尼"],
  pinyin: "Kǒng Zǐ",
  description: "儒家の創始者"
}

// 子路
{
  id: "zilu",
  name: "子路",
  courtesy_name: "子路",
  personal_name: "由",
  aliases: ["仲由", "季路"],
  pinyin: "Zǐ Lù",
  description: "孔子の弟子、勇猛で知られる"
}

// 晏子（衝突解決の例）
{
  id: "yanzi-ying",
  name: "晏子",
  courtesy_name: "平仲",
  personal_name: "嬰",
  aliases: ["晏嬰", "晏平仲"],
  pinyin: "Yàn Zǐ",
  description: "斉の名宰相"
}

// 顔子（衝突解決の例）
{
  id: "yanzi-hui",
  name: "顔子",
  courtesy_name: "子淵",
  personal_name: "回",
  aliases: ["顔回", "顔淵"],
  pinyin: "Yán Zǐ",
  description: "孔子の弟子、最も徳があったとされる"
}
```

## 結果

### メリット

1. **URL フレンドリー**: `/characters/kongzi` のようにクリーンな URL
2. **一貫性**: 全人物で同じ命名規則を適用
3. **衝突解決が明確**: 諱を使う規則により、機械的に解決可能
4. **可読性**: ピンインを知っていれば ID から人物を推測可能

### 考慮事項

1. **編集 UI**: 入力時は漢字で検索・選択し、保存時に ID に変換する UI が必要
2. **aliases の活用**: 検索や自動補完で aliases を活用して入力を支援
3. **衝突の事前検出**: 新規人物登録時に衝突を検出して警告する仕組みが必要
