# ADR-0015: 漢籍階層構造の設計

## ステータス

採用

## コンテキスト

四書五経のデータ構造において、書籍の階層構造をどのように表現するかを決定する必要がある。

### 現状の構造

現在は `book → section → chapter` という近代書籍由来の階層構造を採用している。

```yaml
# books.yaml
- id: lunyu
  name: 論語
  sections:
    - id: '1'
      name: 学而第一
      totalChapters: 16
```

### 問題提起

四書五経は書ごとに本来の構造が異なる:

| 書 | 本来の構造 |
| -- | ---------- |
| 論語・孟子 | 篇 → 章 |
| 大学・中庸 | 章 |
| 易経 | 卦 → 爻辞 → 彖・象 |
| 詩経 | 国風/小雅/大雅/頌 → 詩 |
| 書経・礼記 | 篇 |
| 春秋 | 年 → 月 → 事 |

`section/chapter` という統一的な階層名を当てはめると、漢籍固有の単位（篇・章・卦など）の意味が失われる可能性がある。

### 検討した代替案

#### 代替案: type 付きノード

```typescript
interface TextNode {
  id: string;
  type: 'shu' | 'pian' | 'zhang' | 'ju' | 'gua' | 'yao' | 'shi';
  label: string;
  order: number;
  parent_id?: string;
  children?: TextNode[];
}
```

**メリット:**
- 漢籍固有の単位を忠実に表現
- 易経（卦→爻辞）、詩経（国風→詩）なども自然に表現可能
- 朱子章句・注疏を後からノードに追加可能

**デメリット:**
- 現在の実装からの大幅な変更が必要
- 四書では `section=篇, chapter=章` として問題なく機能している
- 五経を本格的に扱う前に実装するのは YAGNI

## 決定

**現時点では `section/chapter` 構造を維持する。**

### 理由

1. **現在のスコープ**: 主に四書を扱っており、これらは「篇 → 章」構造で統一されている
2. **実用性**: `section`/`chapter` は内部識別子であり、UI では「学而第一」のように正しく表示される
3. **破綻していない**: 論語・孟子・大学・中庸において、現在の構造で問題なく機能している
4. **YAGNI**: 易経・詩経を本格的に追加するまで、type 付きノードへの移行は不要

### 将来の検討事項

五経（特に易経・詩経・春秋）を本格的に追加する際は、以下を検討する:

1. `type` フィールドの追加（`pian` | `zhang` | `gua` | `shi` など）
2. 既存データのマイグレーション戦略
3. UI 表示レイヤでの `section/chapter` への変換

## 結果

### 現在の対応表

| 漢籍用語 | 現在のフィールド | 備考 |
| -------- | ---------------- | ---- |
| 篇 | `section` | 論語「学而」、孟子「梁惠王上」など |
| 章 | `chapter` | 各篇内の章（論語 1-1 など） |

### 影響

- 五経を本格追加するまでは変更不要
- ADR-0001 のコンテンツデータ構造と整合

## 関連

- [ADR-0001: コンテンツデータ構造の設計](./0001-content-data-structure.md)
- [ADR-0012: コンテンツディレクトリ構造](./0012-content-directory-structure.md)
